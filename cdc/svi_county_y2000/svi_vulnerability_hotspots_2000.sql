-- Social Vulnerability Hotspots Analysis for Emergency Preparedness
-- 
-- Business Purpose:
-- Identify counties with the highest social vulnerability based on multiple risk factors
-- to help healthcare organizations and emergency responders prioritize resource allocation
-- and develop targeted intervention strategies.

WITH vulnerable_counties AS (
  SELECT 
    state_name,
    county,
    -- Overall vulnerability score
    ustp as total_vulnerability_percentile,
    
    -- Key demographic risk factors
    g2v1r as elderly_ratio,
    g2v3r as disability_ratio,
    g1v1r as poverty_ratio,
    
    -- Access challenges
    g4v4r as no_vehicle_ratio,
    g3v2r as limited_english_ratio,
    
    -- Population context
    totpop2000 as total_population
  FROM mimi_ws_1.cdc.svi_county_y2000
  
  -- Focus on counties with significant population
  WHERE totpop2000 >= 10000
)

SELECT 
  state_name,
  county,
  total_vulnerability_percentile,
  
  -- Format key metrics as percentages
  ROUND(elderly_ratio * 100, 1) as pct_elderly,
  ROUND(disability_ratio * 100, 1) as pct_disability,
  ROUND(poverty_ratio * 100, 1) as pct_poverty,
  ROUND(no_vehicle_ratio * 100, 1) as pct_no_vehicle,
  ROUND(limited_english_ratio * 100, 1) as pct_limited_english,
  
  total_population
FROM vulnerable_counties
WHERE total_vulnerability_percentile >= 90  -- Focus on top 10% most vulnerable
ORDER BY total_vulnerability_percentile DESC
LIMIT 20;

-- How this query works:
-- 1. Creates a CTE to select key vulnerability indicators and filter for populated counties
-- 2. Formats results as percentages for easier interpretation
-- 3. Identifies the top 20 most vulnerable counties based on overall SVI percentile
--
-- Assumptions & Limitations:
-- - Uses 10,000 population threshold to focus on more populated areas
-- - Based on 2000 data which may not reflect current conditions
-- - Focuses on overall vulnerability rather than specific domain scores
-- 
-- Possible Extensions:
-- 1. Add geographic clustering to identify vulnerable regions
-- 2. Compare vulnerability scores across domains (socioeconomic, household, etc.)
-- 3. Join with disaster impact data to validate predictive value
-- 4. Create vulnerability tiers for different population sizes
-- 5. Add year-over-year comparison when using with multi-year data

/*

    - Author: claude-3-5-sonnet-20241022
    - Created At: 2024-11-06T00:21:26.568525
    - Additional Notes: Query filters for counties with population >= 10,000 to ensure statistical relevance and focuses on the intersection of health vulnerability factors (elderly, disability) with access barriers (poverty, transportation, language). The 90th percentile threshold highlights the most critical areas for intervention.
    
    */