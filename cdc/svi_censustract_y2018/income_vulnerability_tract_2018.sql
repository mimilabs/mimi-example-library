-- Title: Social Vulnerability Income Analysis by Census Tract - 2018
--
-- Business Purpose:
-- Analyze income-related social vulnerability indicators at the census tract level
-- to identify areas where healthcare organizations should focus their financial
-- assistance programs and community outreach efforts. This analysis helps
-- healthcare organizations better target their resources to serve low-income
-- communities and meet community benefit requirements.

WITH tract_income_metrics AS (
    -- Calculate key income-related metrics by census tract
    SELECT 
        state,
        county,
        location,
        e_totpop AS population,
        e_pci AS per_capita_income,
        ep_pov AS poverty_rate,
        ep_uninsur AS uninsured_rate,
        -- Create composite income vulnerability score
        (epl_pci + epl_pov)/2 AS income_vulnerability_score
    FROM mimi_ws_1.cdc.svi_censustract_y2018
    WHERE e_totpop > 100  -- Filter out very small populations
)

SELECT 
    state,
    county,
    location,
    population,
    ROUND(per_capita_income, 0) AS per_capita_income,
    ROUND(poverty_rate, 1) AS poverty_rate_pct,
    ROUND(uninsured_rate, 1) AS uninsured_rate_pct,
    ROUND(income_vulnerability_score, 2) AS income_vulnerability_score,
    -- Flag high-priority tracts
    CASE 
        WHEN income_vulnerability_score >= 0.75 THEN 'High Priority'
        WHEN income_vulnerability_score >= 0.50 THEN 'Medium Priority'
        ELSE 'Lower Priority'
    END AS priority_level
FROM tract_income_metrics
WHERE poverty_rate > 0 AND uninsured_rate > 0  -- Remove invalid records
ORDER BY income_vulnerability_score DESC, population DESC;

-- How this query works:
-- 1. Creates a CTE to calculate income-related vulnerability metrics
-- 2. Combines per capita income percentile and poverty percentile into a composite score
-- 3. Categorizes census tracts into priority levels based on composite score
-- 4. Orders results to show highest priority areas first

-- Assumptions and Limitations:
-- - Assumes census tracts with population < 100 are not meaningful for analysis
-- - Relies on accurate reporting of income and poverty data
-- - Does not account for cost of living differences across regions
-- - May not capture all aspects of financial need

-- Possible Extensions:
-- 1. Add geographic clustering to identify concentrated areas of need
-- 2. Include additional demographic factors like age and disability status
-- 3. Compare against state/national averages for benchmarking
-- 4. Add year-over-year trend analysis when historical data is available
-- 5. Include healthcare facility location data to identify coverage gaps

/*

    - Author: claude-3-5-sonnet-20241022
    - Created At: 2024-11-03T13:26:30.260430
    - Additional Notes: The query focuses specifically on income-related vulnerability factors that impact healthcare access and financial assistance needs. The composite scoring method (income_vulnerability_score) provides a simplified way to prioritize census tracts but may need adjustment based on specific organizational priorities. Consider local cost of living adjustments when using across different regions.
    
    */